{% load static %}
<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="{% static 'styles/container.css' %}">
    <script type="text/javascript" src="{% static 'js/jquery.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/vue.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/vue-strap.js' %}"></script>
    <title>Quantra</title>
</head>
{% verbatim %}
<body>
<div id="sidebar">
    <div class="logo">
        <a href="/"><img src="res/images/logo.png"></a>
    </div>
    <div id="nav">
        <ul class="nav nav-stacked">
            <li role="presentation" data-view="market">
                <a href="javascript:" v-bind:class="{ act: selected == 'market' }" v-on:click="navClick"
                   data-view="market">
                    市场
                </a>
                <a href="javascript:" v-bind:class="{ act: selected == 'stocklist' }" v-on:click="navClick"
                   data-view="stocklist">
                    股票
                </a>
                <a href="javascript:" v-bind:class="{ act: selected == 'compare' }" v-on:click="navClick"
                   data-view="compare">
                    对比
                </a>
            </li>
        </ul>
    </div>
</div>
<div id="container">
    <div class="loading" v-if="loading > 0">
        <i class="fa fa-5x fa-refresh fa-spin"></i>
    </div>
    <div id="content" v-bind:class="{ hidden: loading > 0 }">
    </div>
</div>

<script type="text/javascript">
    // app container
    window.app = {
        nav: new Vue({
            el: '#nav',
            data: {
                selected: ''
            },
            methods: {
                navClick: function (e) {
                    app.loadView(e.target.dataset.view);
                }
            }
        }),

        loading: new Vue({
            el: '#container',
            data: {
                loading: 0
            },
            methods: {
                show: function () {
                    this.loading++;
                },
                hide: function () {
                    this.loading--;
                    if (this.loading < 0) this.loading = 0;
                }
            }
        }),

        loadView: function (name) {
            app.loading.show();
            window.location.hash = name;
            app.nav.selected = name;
            $('#content').load('res/views/' + name + '.html', function () {
                app.loading.hide();
            });
        },

        dates: {
            min: '',
            max: '',
            fetch: function () {
                return $.getJSON('/api/stock/date_range').done(function (data) {
                    app.dates.min = data.min;
                    app.dates.max = data.max;
                });
            }
        },

        utils: {
            formatCode: function (code) {
                var s = '00000' + code;
                return s.substr(s.length - 6);
            },

            formatPercent: function (pct) {
                return Math.round(pct * 10000) / 100 + '%';
            }
        }
    };

    $(function () {
        app.dates.fetch().always(function () {
            var hash = location.hash.substr(1);
            if (hash != '') {
                app.loadView(hash);
            } else {
                app.loadView('market');
            }
        });
    });
</script>
</body>
{% endverbatim %}
</html>