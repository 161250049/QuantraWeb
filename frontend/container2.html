{% load static %}
<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <link rel="stylesheet" type="text/css" href="{% static 'styles/container2.css' %}">
    <script type="text/javascript" src="{% static 'js/jquery.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/vue.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/vue-strap.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/echarts.min.js' %}"></script>
    <title>Quantra</title>
</head>
{% verbatim %}
<body>
<header>
    <div>
        <a href="javascript:" onclick="app.loadView('home');">
            <img src="res/images/logo.png">
        </a>
    </div>
    <div>
        <ul id="nav">
            <li><a href="javascript:" v-bind:class="{ act: selected == 'home' }" v-on:click="navClick"
                   data-view="home">
                首页
            </a></li>
            <li><a href="javascript:" v-bind:class="{ act: selected == 'market' }" v-on:click="navClick"
                   data-view="market">
                市场
            </a></li>
            <li><a href="javascript:" v-bind:class="{ act: selected == 'stocklist' }" v-on:click="navClick"
                   data-view="stocklist">
                行情
            </a></li>
            <li><a href="javascript:" v-bind:class="{ act: selected == 'realtime' }" v-on:click="navClick"
                   data-view="realtime">
                实时行情 (Beta)
            </a></li>
            <li><a href="javascript:" v-bind:class="{ act: selected == 'compare' }" v-on:click="navClick"
                   data-view="compare">
                对比
            </a></li>
        </ul>
    </div>
</header>
<div id="container">
    <div class="loading" v-if="loading > 0">
        <i class="mdi mdi-loading mdi-spin" style="font-size: 128px;"></i>
    </div>
    <div id="content" v-bind:class="{ hidden: loading > 0 }">
    </div>
</div>

<script type="text/javascript">
    // app container
    window.app = {
        nav: new Vue({
            el: '#nav',
            data: {
                selected: ''
            },
            methods: {
                navClick: function (e) {
                    app.loadView(e.target.dataset.view);
                }
            }
        }),

        loading: new Vue({
            el: '#container',
            data: {
                loading: 0
            },
            methods: {
                show: function () {
                    this.loading++;
                },
                hide: function () {
                    this.loading--;
                    if (this.loading < 0) this.loading = 0;
                }
            }
        }),

        loadView: function (name) {
            app.loading.show();
            window.location.hash = name;
            app.nav.selected = name;
            $('#content').load('res/views/' + name + '.html?' + new Date().getTime(), function () {
                app.loading.hide();
            });
        },

        requests: {
            ws: null,
            wsConnect: function (path) {
                if (app.requests.ws != null) {
                    app.requests.ws.close();
                }
                app.requests.ws = new WebSocket('ws://' + location.host + '/' + path);
            }
        },

        dates: {
            min: '',
            max: '',
            fetch: function () {
                return $.getJSON('/api/stock/date_range').done(function (data) {
                    app.dates.min = data.min;
                    app.dates.max = data.max;
                });
            }
        },

        utils: {
            formatCode: function (code) {
                var s = '00000' + code;
                return s.substr(s.length - 6);
            },

            formatPercent: function (pct) {
                return Math.round(pct * 10000) / 100 + '%';
            }
        }
    };

    $(function () {
        app.loading.show();
        app.dates.fetch().always(function () {
            app.loading.hide();
            var hash = location.hash.substr(1);
            if (hash != '') {
                app.loadView(hash);
            } else {
                app.loadView('home');
            }
        });
    });
</script>
</body>
{% endverbatim %}
</html>